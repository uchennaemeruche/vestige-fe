import{o as ni,l as ii,_ as Et,a as ce,B as oi,b as l,c as P,d as w,e as si}from"./index.0a346673.js";var ri={exchange:"/v1/auth/accesskey/exchange"},et={verify:"/v1/auth/otp/verify",signIn:"/v1/auth/otp/signin",signUp:"/v1/auth/otp/signup",update:{email:"/v1/auth/otp/update/email",phone:"/v1/auth/otp/update/phone"},signUpOrIn:"/v1/auth/otp/signup-in"},nt={verify:"/v1/auth/magiclink/verify",signIn:"/v1/auth/magiclink/signin",signUp:"/v1/auth/magiclink/signup",update:{email:"/v1/auth/magiclink/update/email",phone:"/v1/auth/magiclink/update/phone"},signUpOrIn:"/v1/auth/magiclink/signup-in"},it={verify:"/v1/auth/enchantedlink/verify",signIn:"/v1/auth/enchantedlink/signin",signUp:"/v1/auth/enchantedlink/signup",session:"/v1/auth/enchantedlink/pending-session",update:{email:"/v1/auth/enchantedlink/update/email"},signUpOrIn:"/v1/auth/enchantedlink/signup-in"},Ae={start:"/v1/auth/oauth/authorize",exchange:"/v1/auth/oauth/exchange"},Ue={start:"/v1/auth/saml/authorize",exchange:"/v1/auth/saml/exchange"},Gt={verify:"/v1/auth/totp/verify",signUp:"/v1/auth/totp/signup",update:"/v1/auth/totp/update"},G={signUp:{start:"/v1/auth/webauthn/signup/start",finish:"/v1/auth/webauthn/signup/finish"},signIn:{start:"/v1/auth/webauthn/signin/start",finish:"/v1/auth/webauthn/signin/finish"},signUpOrIn:{start:"/v1/auth/webauthn/signup-in/start"},update:{start:"v1/auth/webauthn/update/start",finish:"/v1/auth/webauthn/update/finish"}},ot={signUp:"/v1/auth/password/signup",signIn:"/v1/auth/password/signin",sendReset:"/v1/auth/password/reset",update:"/v1/auth/password/update",replace:"/v1/auth/password/replace",policy:"/v1/auth/password/policy"},ai="/v1/auth/refresh",li="/v1/auth/logout",di="/v1/auth/logoutall",ci="/v1/auth/me",xe={start:"/v1/flow/start",next:"/v1/flow/next"};const Ce=1e3,Ee=6e5,Re=()=>{const e={};return{headers(t){const n=typeof t.entries=="function"?Object.fromEntries(t.entries()):t;return e.Headers=JSON.stringify(n),this},body(t){return e.Body=t,this},url(t){return e.Url=t.toString(),this},method(t){return e.Method=t,this},title(t){return e.Title=t,this},status(t){return e.Status=t,this},build:()=>Object.keys(e).flatMap(t=>e[t]?[`${t!=="Title"?`${t}: `:""}${e[t]}`]:[]).join(`
`)}},ui=(e,t)=>{const n=(i=>async(...o)=>{const s=await i(...o),r=await s.text();return s.text=()=>Promise.resolve(r),s.json=()=>Promise.resolve(JSON.parse(r)),s.clone=()=>s,s})(t||fetch);return n||e==null||e.warn("Fetch is not defined, you will not be able to send http requests, if you are running in a test, make sure fetch is defined globally"),e?async(...i)=>{if(!n)throw Error("Cannot send http request, fetch is not defined, if you are running in a test, make sure fetch is defined globally");e.log((s=>Re().title("Request").url(s[0]).method(s[1].method).headers(s[1].headers).body(s[1].body).build())(i));const o=await n(...i);return e[o.ok?"log":"error"](await(async s=>{const r=await s.text();return Re().title("Response").url(s.url.toString()).status(`${s.status} ${s.statusText}`).headers(s.headers).body(r).build()})(o)),o}:n};var lt;(function(e){e.get="GET",e.delete="DELETE",e.post="POST",e.put="PUT"})(lt||(lt={}));const hi=(...e)=>new Headers(e.reduce((t,n)=>((o=>Array.isArray(o)?o:o instanceof Headers?Array.from(o.entries()):o?Object.entries(o):[])(n).reduce((o,[s,r])=>(t[s]=r,t),t),t),{})),pi=e=>e===void 0?void 0:JSON.stringify(e),gi=(e,t="")=>{let n=e;return t&&(n=n+":"+t),{Authorization:`Bearer ${n}`}},fi=({baseUrl:e,projectId:t,baseConfig:n,logger:i,hooks:o,cookiePolicy:s,fetch:r})=>{const a=ui(i,r),d=async c=>{const u=o!=null&&o.beforeRequest?o.beforeRequest(c):c,{path:p,body:f,headers:y,queryParams:O,method:b,token:k}=u,I=await a((({path:C,baseUrl:A,queryParams:S})=>{const x=new URL(C,A);return S&&(x.search=new URLSearchParams(S).toString()),x})({path:p,baseUrl:e,queryParams:O}),{headers:hi(gi(t,k),{"x-descope-sdk-name":"core-js","x-descope-sdk-version":"1.9.2"},(n==null?void 0:n.baseHeaders)||{},y),method:b,body:pi(f),credentials:s||"include"});return o!=null&&o.afterRequest&&await o.afterRequest(c,I==null?void 0:I.clone()),I};return{get:(c,{headers:u,queryParams:p,token:f}={})=>d({path:c,headers:u,queryParams:p,body:void 0,method:lt.get,token:f}),post:(c,u,{headers:p,queryParams:f,token:y}={})=>d({path:c,headers:p,queryParams:f,body:u,method:lt.post,token:y}),put:(c,u,{headers:p,queryParams:f,token:y}={})=>d({path:c,headers:p,queryParams:f,body:u,method:lt.put,token:y}),delete:(c,{headers:u,queryParams:p,token:f}={})=>d({path:c,headers:u,queryParams:p,body:void 0,method:lt.delete,token:f}),hooks:o}};var vi={TOO_MANY_REQUESTS:429};function pn(e,t,n){var i;let o=ue(e);t&&(o=(i=o==null?void 0:o.tenants)===null||i===void 0?void 0:i[t]);const s=o==null?void 0:o[n];return Array.isArray(s)?s:[]}function ue(e){if(typeof e!="string"||!e)throw new Error("Invalid token provided");return ni(e)}function mi(e){const{exp:t}=ue(e);return new Date().getTime()/1e3>t}function bi(e){let t=ue(e);const n=Object.keys(t==null?void 0:t.tenants);return Array.isArray(n)?n:[]}function wi(e,t){return pn(e,t,"permissions")}function yi(e,t){return pn(e,t,"roles")}const L=(...e)=>e.join("/").replace(/\/{2,}/g,"/");async function h(e,t){var n;const i=await e,o={code:i.status,ok:i.ok,response:i},s=await i.clone().json();return i.ok?o.data=t?t(s):s:(o.error=s,i.status===vi.TOO_MANY_REQUESTS&&Object.assign(o.error,{retryAfter:Number.parseInt((n=i.headers)===null||n===void 0?void 0:n.get("retry-after"))||0})),o}const ct=(e,t)=>(n=t)=>i=>!e(i)&&n.replace("{val}",i),gn=(...e)=>({validate:t=>(e.forEach(n=>{const i=n(t);if(i)throw new Error(i)}),!0)}),fn=e=>t=>e.test(t),Ii=fn(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/),ki=fn(/^\+[1-9]{1}[0-9]{3,14}$/),Si=ct(Ii,'"{val}" is not a valid email'),$i=ct(ki,'"{val}" is not a valid phone number'),Oi=ct((Pe=1,e=>e.length>=Pe),"Minimum length is 1");var Pe;const kt=ct(e=>typeof e=="string","Input is not a string"),ji=ct(e=>e===void 0,"Input is defined"),Ai=(Zt=[kt(),ji()],Te="Input is not a string or undefined",(e=Te)=>t=>{const n=Zt.filter(i=>i(t));return!(n.length<Zt.length)&&(e?e.replace("{val}",t):n.join(" OR "))});var Zt,Te;const g=(...e)=>t=>(...n)=>(e.forEach((i,o)=>gn(...i).validate(n[o])),t(...n)),v=e=>[kt(`"${e}" must be a string`),Oi(`"${e}" must not be empty`)],he=e=>[kt(`"${e}" must be a string`),Si()],vn=e=>[kt(`"${e}" must be a string`),$i()],Ui=g(v("accessKey")),xi=e=>({exchange:Ui(t=>h(e.post(ri.exchange,{},{token:t})))});var yt,se;(function(e){e.sms="sms",e.whatsapp="whatsapp"})(yt||(yt={})),function(e){e.email="email"}(se||(se={}));const M=Object.assign(Object.assign({},yt),se);var Le;(function(e){e.waiting="waiting",e.running="running",e.completed="completed",e.failed="failed"})(Le||(Le={}));const mn=v("loginId"),Ci=g(v("token")),Qt=g(mn),Ei=g(v("pendingRef")),Ri=g(mn,he("email")),Pi=e=>({verify:Ci(t=>h(e.post(it.verify,{token:t}))),signIn:Qt((t,n,i,o)=>h(e.post(L(it.signIn,M.email),{loginId:t,URI:n,loginOptions:i},{token:o}))),signUpOrIn:Qt((t,n)=>h(e.post(L(it.signUpOrIn,M.email),{loginId:t,URI:n}))),signUp:Qt((t,n,i)=>h(e.post(L(it.signUp,M.email),{loginId:t,URI:n,user:i}))),waitForSession:Ei((t,n)=>new Promise(i=>{const{pollingIntervalMs:o,timeoutMs:s}=(({pollingIntervalMs:d=1e3,timeoutMs:c=6e5}={})=>({pollingIntervalMs:Math.max(d||Ce,Ce),timeoutMs:Math.min(c||Ee,Ee)}))(n);let r;const a=setInterval(async()=>{const d=await e.post(it.session,{pendingRef:t});d.ok&&(clearInterval(a),r&&clearTimeout(r),i(h(Promise.resolve(d))))},o);r=setTimeout(()=>{i({error:{errorDescription:`Session polling timeout exceeded: ${s}ms`,errorCode:"0"},ok:!1}),clearInterval(a)},s)})),update:{email:Ri((t,n,i,o,s)=>h(e.post(it.update.email,Object.assign({loginId:t,email:n,URI:i},s),{token:o})))}}),Ti=g(v("flowId")),Li=g(v("executionId"),v("stepId"),v("interactionId")),qi=e=>({start:Ti((t,n,i,o,s,r)=>h(e.post(xe.start,{flowId:t,options:n,conditionInteractionId:i,interactionId:o,input:s,version:r}))),next:Li((t,n,i,o,s)=>h(e.post(xe.next,{executionId:t,stepId:n,interactionId:i,input:o,version:s})))}),pe=v("loginId"),Mi=g(v("token")),Yt=g(pe),_i=g(pe,vn("phone")),Wi=g(pe,he("email")),Ni=e=>({verify:Mi(t=>h(e.post(nt.verify,{token:t}))),signIn:Object.keys(M).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Yt((i,o,s,r)=>h(e.post(L(nt.signIn,n),{loginId:i,URI:o,loginOptions:s},{token:r})))}),{}),signUp:Object.keys(M).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Yt((i,o,s)=>h(e.post(L(nt.signUp,n),{loginId:i,URI:o,user:s})))}),{}),signUpOrIn:Object.keys(M).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Yt((i,o)=>h(e.post(L(nt.signUpOrIn,n),{loginId:i,URI:o})))}),{}),update:{email:Wi((t,n,i,o,s)=>h(e.post(nt.update.email,Object.assign({loginId:t,email:n,URI:i},s),{token:o}))),phone:Object.keys(yt).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:_i((i,o,s,r,a)=>h(e.post(L(nt.update.phone,n),Object.assign({loginId:i,phone:o,URI:s},a),{token:r})))}),{})}});var re;(function(e){e.facebook="facebook",e.github="github",e.google="google",e.microsoft="microsoft",e.gitlab="gitlab",e.apple="apple",e.discord="discord",e.linkedin="linkedin"})(re||(re={}));const Di=g(v("code")),Ki=e=>({start:Object.keys(re).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:(i,o,s)=>h(e.post(Ae.start,o||{},{queryParams:Object.assign({provider:n},i&&{redirectURL:i}),token:s}))}),{}),exchange:Di(t=>h(e.post(Ae.exchange,{code:t})))}),Jt=v("loginId"),Ji=g(Jt,v("code")),Xt=g(Jt),Fi=g(Jt,vn("phone")),Hi=g(Jt,he("email")),Vi=e=>({verify:Object.keys(M).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Ji((i,o)=>h(e.post(L(et.verify,n),{code:o,loginId:i})))}),{}),signIn:Object.keys(M).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Xt((i,o,s)=>h(e.post(L(et.signIn,n),{loginId:i,loginOptions:o},{token:s})))}),{}),signUp:Object.keys(M).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Xt((i,o)=>h(e.post(L(et.signUp,n),{loginId:i,user:o})))}),{}),signUpOrIn:Object.keys(M).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Xt(i=>h(e.post(L(et.signUpOrIn,n),{loginId:i})))}),{}),update:{email:Hi((t,n,i,o)=>h(e.post(et.update.email,Object.assign({loginId:t,email:n},o),{token:i}))),phone:Object.keys(yt).reduce((t,n)=>Object.assign(Object.assign({},t),{[n]:Fi((i,o,s,r)=>h(e.post(L(et.update.phone,n),Object.assign({loginId:i,phone:o},r),{token:s})))}),{})}}),Bi=g(v("tenant")),zi=g(v("code")),Gi=e=>({start:Bi((t,n,i,o)=>h(e.post(Ue.start,i||{},{queryParams:{tenant:t,redirectURL:n},token:o}))),exchange:zi(t=>h(e.post(Ue.exchange,{code:t})))}),ge=v("loginId"),Zi=g(ge,v("code")),Qi=g(ge),Yi=g(ge),Xi=e=>({signUp:Qi((t,n)=>h(e.post(Gt.signUp,{loginId:t,user:n}))),verify:Zi((t,n,i,o)=>h(e.post(Gt.verify,{loginId:t,code:n,loginOptions:i},{token:o}))),update:Yi((t,n)=>h(e.post(Gt.update,{loginId:t},{token:n})))}),Ft=v("loginId"),bn=v("newPassword"),qe=g(Ft,v("password")),to=g(Ft),eo=g(Ft,bn),no=g(Ft,v("oldPassword"),bn),io=e=>({signUp:qe((t,n,i)=>h(e.post(ot.signUp,{loginId:t,password:n,user:i}))),signIn:qe((t,n)=>h(e.post(ot.signIn,{loginId:t,password:n}))),sendReset:to((t,n)=>h(e.post(ot.sendReset,{loginId:t,redirectUrl:n}))),update:eo((t,n,i)=>h(e.post(ot.update,{loginId:t,newPassword:n},{token:i}))),replace:no((t,n,i)=>h(e.post(ot.replace,{loginId:t,oldPassword:n,newPassword:i}))),policy:()=>h(e.get(ot.policy))}),oo=[kt('"loginId" must be a string')],fe=v("loginId"),Ht=v("origin"),so=g(fe,Ht,v("name")),ro=g(fe,Ht),ao=g(oo,Ht),lo=g(fe,Ht,v("token")),te=g(v("transactionId"),v("response")),co=e=>({signUp:{start:so((t,n,i)=>h(e.post(G.signUp.start,{user:{loginId:t,name:i},origin:n}))),finish:te((t,n)=>h(e.post(G.signUp.finish,{transactionId:t,response:n})))},signIn:{start:ao((t,n,i,o)=>h(e.post(G.signIn.start,{loginId:t,origin:n,loginOptions:i},{token:o}))),finish:te((t,n)=>h(e.post(G.signIn.finish,{transactionId:t,response:n})))},signUpOrIn:{start:ro((t,n)=>h(e.post(G.signUpOrIn.start,{loginId:t,origin:n})))},update:{start:lo((t,n,i)=>h(e.post(G.update.start,{loginId:t,origin:n},{token:i}))),finish:te((t,n)=>h(e.post(G.update.finish,{transactionId:t,response:n})))}}),Ut=g(v("token")),xt=g((e=>[Ai(`"${e}" must be string or undefined`)])("token"));var Me,_e,uo=g([(Me="projectId",_e=v("projectId"),ct(((e,t)=>n=>gn(...t).validate(ii(n,e)))(Me,_e))())])((e=>t=>{var n,i;const o=[].concat(((n=t.hooks)===null||n===void 0?void 0:n.beforeRequest)||[]),s=[].concat(((i=t.hooks)===null||i===void 0?void 0:i.afterRequest)||[]);return e(Object.assign(Object.assign({},t),{hooks:{beforeRequest:r=>o==null?void 0:o.reduce((a,d)=>d(a),r),afterRequest:async(r,a)=>{(await Promise.allSettled(s==null?void 0:s.map(d=>d(r,a==null?void 0:a.clone())))).forEach(d=>{var c;return d.status==="rejected"&&((c=t.logger)===null||c===void 0?void 0:c.error(d.reason))})}}}))})(({projectId:e,logger:t,baseUrl:n,hooks:i,cookiePolicy:o,baseHeaders:s={},fetch:r})=>{return a=fi({baseUrl:n||"https://api.descope.com",projectId:e,logger:t,hooks:i,cookiePolicy:o,baseConfig:{baseHeaders:s},fetch:r}),{accessKey:xi(a),otp:Vi(a),magicLink:Ni(a),enchantedLink:Pi(a),oauth:Ki(a),saml:Gi(a),totp:Xi(a),webauthn:co(a),password:io(a),flow:qi(a),refresh:xt(d=>h(a.post(ai,{},{token:d}))),logout:xt(d=>h(a.post(li,{},{token:d}))),logoutAll:xt(d=>h(a.post(di,{},{token:d}))),me:xt(d=>h(a.get(ci,{token:d}))),isJwtExpired:Ut(mi),getTenants:Ut(bi),getJwtPermissions:Ut(wi),getJwtRoles:Ut(yi),httpClient:a};var a}));const ht=(e,t,n)=>(t.forEach(i=>{const o=i.split(".");let s=o.shift(),r=e;for(;o.length>0;){if(r=r[s],!s||!r)throw Error(`Invalid path "${i}", "${s}" is missing or has no value`);s=o.shift()}if(typeof r[s]!="function")throw Error(`"${i}" is not a function`);const a=r[s];r[s]=n(a)}),e);var ho=Object.assign(uo,{DeliveryMethods:M});const pt=(e,t)=>{var n;return["beforeRequest","afterRequest"].reduce((i,o)=>{var s;return i[o]=[].concat(((s=e.hooks)===null||s===void 0?void 0:s[o])||[]).concat((t==null?void 0:t[o])||[]),i},(n=e.hooks)!==null&&n!==void 0?n:e.hooks={}),e},Rt=async e=>{if(!(e!=null&&e.ok))return{};const t=await(e==null?void 0:e.clone().json());return(t==null?void 0:t.authInfo)||t||{}},We=async e=>{const t=await Rt(e);return(t==null?void 0:t.user)||(t!=null&&t.hasOwnProperty("userId")?t:void 0)},ve=typeof localStorage<"u",qt=(e,t)=>ve&&(localStorage==null?void 0:localStorage.setItem(e,t)),Vt=e=>ve&&(localStorage==null?void 0:localStorage.getItem(e)),Mt=e=>ve&&(localStorage==null?void 0:localStorage.removeItem(e)),gt=(...e)=>{console.debug(...e)},_t=typeof window<"u",po=_t&&(localStorage==null?void 0:localStorage.getItem("fingerprint.endpoint.url"))||"https://fp.descope.com",wn=(e="",t="")=>({vsid:e,vrid:t}),yn=(e=!1)=>{const t=localStorage.getItem("fp");if(!t)return null;const n=JSON.parse(t);return new Date().getTime()>n.expiry&&!e?null:n.value},go=async e=>{try{if(yn())return;const t=(Date.now().toString(36)+Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)).substring(0,27),n=oi({apiKey:e,endpoint:po}),i=await n,{requestId:o}=await i.get({linkedId:t});(s=>{const r={value:s,expiry:new Date().getTime()+864e5};localStorage.setItem("fp",JSON.stringify(r))})(wn(t,o))}catch(t){global.FB_DEBUG&&console.error(t)}},fo=e=>(e.body&&(e.body.fpData=yn(!0)||wn()),e),me="dls_last_user_login_id",be="dls_last_user_display_name",In=()=>Vt(me),kn=()=>Vt(be),vo=e=>async(...t)=>{var n;t[1]=t[1]||{};const[,i={}]=t,o=In(),s=kn();return o&&((n=i.lastAuth)!==null&&n!==void 0||(i.lastAuth={}),i.lastAuth.loginId=o,i.lastAuth.name=s),await e(...t)},mo=e=>async(...t)=>{const n=await e(...t);return Mt(me),Mt(be),n};function Ne(){const e=[];return{pub:t=>{e.forEach(n=>n(t))},sub:t=>{const n=e.push(t)-1;return()=>e.splice(n,1)}}}const dt="DS",we="DSR",bo=(e={},t,n)=>{var{refreshJwt:i,sessionJwt:o}=e,s=Et(e,["refreshJwt","sessionJwt"]);t===void 0&&(t=!1),n===void 0&&(n=""),i&&qt(`${n}${we}`,i),o&&(t?function(r,a,{cookiePath:d,cookieDomain:c,cookieExpiration:u}){if(a){const p=new Date(1e3*u);ce.set(r,a,{path:d,domain:c,expires:p,sameSite:"Strict",secure:!0})}}(dt,o,s):qt(`${n}${dt}`,o))};function De(e=""){return Vt(`${e}${we}`)||""}function Sn(e=""){Mt(`${e}${we}`),Mt(`${e}${dt}`),ce.remove(dt)}const wo=e=>t=>async(...n)=>{const i=await t(...n);return Sn(e),i};async function Ct(e){const t=function(o){var s;const r=JSON.parse(o);return r.publicKey.challenge=mt(r.publicKey.challenge),r.publicKey.user.id=mt(r.publicKey.user.id),(s=r.publicKey.excludeCredentials)===null||s===void 0||s.forEach(a=>{a.id=mt(a.id)}),r}(e);return i=await navigator.credentials.create(t),JSON.stringify({id:i.id,rawId:V(i.rawId),type:i.type,response:{attestationObject:V(i.response.attestationObject),clientDataJSON:V(i.response.clientDataJSON)}});var i}async function ee(e){const t=On(e);return jn(await navigator.credentials.get(t))}async function yo(e,t){const n=On(e);return n.signal=t.signal,n.mediation="conditional",jn(await navigator.credentials.get(n))}async function $n(e=!1){if(!_t)return Promise.resolve(!1);const t=!!(window.PublicKeyCredential&&navigator.credentials&&navigator.credentials.create&&navigator.credentials.get);return t&&e&&PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable?PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():t}function On(e){var t;const n=JSON.parse(e);return n.publicKey.challenge=mt(n.publicKey.challenge),(t=n.publicKey.allowCredentials)===null||t===void 0||t.forEach(i=>{i.id=mt(i.id)}),n}function jn(e){return JSON.stringify({id:e.id,rawId:V(e.rawId),type:e.type,response:{authenticatorData:V(e.response.authenticatorData),clientDataJSON:V(e.response.clientDataJSON),signature:V(e.response.signature),userHandle:e.response.userHandle?V(e.response.userHandle):void 0}})}function mt(e){const t=e.replace(/_/g,"/").replace(/-/g,"+");return Uint8Array.from(atob(t),n=>n.charCodeAt(0)).buffer}function V(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}var Ke,Io=(Ke=e=>({async signUp(t,n){const i=await e.webauthn.signUp.start(t,window.location.origin,n);if(!i.ok)return i;const o=await Ct(i.data.options);return await e.webauthn.signUp.finish(i.data.transactionId,o)},async signIn(t){const n=await e.webauthn.signIn.start(t,window.location.origin);if(!n.ok)return n;const i=await ee(n.data.options);return await e.webauthn.signIn.finish(n.data.transactionId,i)},async signUpOrIn(t){var n;const i=await e.webauthn.signUpOrIn.start(t,window.location.origin);if(!i.ok)return i;if(!((n=i.data)===null||n===void 0)&&n.create){const o=await Ct(i.data.options);return await e.webauthn.signUp.finish(i.data.transactionId,o)}{const o=await ee(i.data.options);return await e.webauthn.signIn.finish(i.data.transactionId,o)}},async update(t,n){const i=await e.webauthn.update.start(t,window.location.origin,n);if(!i.ok)return i;const o=await Ct(i.data.options);return await e.webauthn.update.finish(i.data.transactionId,o)},helpers:{create:Ct,get:ee,isSupported:$n,conditional:yo}}),(...e)=>{const t=Ke(...e);return Object.assign(t.signUp,e[0].webauthn.signUp),Object.assign(t.signIn,e[0].webauthn.signIn),Object.assign(t.signUpOrIn,e[0].webauthn.signUpOrIn),Object.assign(t.update,e[0].webauthn.update),t}),ko=e=>Object.assign(Object.assign({},e.flow),{start:async(...t)=>{const n=await $n(),i=Object.assign(Object.assign({redirectUrl:window.location.href,location:window.location.href},t[1]),{deviceInfo:{webAuthnSupport:n}});return t[1]=i,e.flow.start(...t)}});const So=function(...e){return t=>e.reduce((n,i)=>i(n),t)}(e=>t=>{var{fpKey:n,fpLoad:i}=t,o=Et(t,["fpKey","fpLoad"]);return n?(_t?i&&go(n).catch(()=>null):console.warn("Fingerprint is a client side only capability and will not work when running in the server"),e(pt(o,{beforeRequest:fo}))):e(Object.assign({},o))},e=>t=>{var{autoRefresh:n}=t,i=Et(t,["autoRefresh"]);if(!n)return e(i);const{clearAllTimers:o,setTimer:s}=(()=>{const c=[];return{clearAllTimers:()=>{for(;c.length;)clearTimeout(c.pop())},setTimer:(u,p)=>{c.push(setTimeout(u,p))}}})();let r,a;document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&new Date>r&&(gt("Expiration time passed, refreshing session"),d.refresh(a))});const d=e(pt(i,{afterRequest:async(c,u)=>{const{refreshJwt:p,sessionJwt:f}=await Rt(u);if((u==null?void 0:u.status)===401)gt("Received 401, canceling all timers"),o();else if(f){r=(k=>{const I=k.split(".");try{if(I.length===3){const C=JSON.parse(window.atob(I[1]));if(C.exp)return new Date(1e3*C.exp)}}catch{}return null})(f),a=p;const O=((y=r)?y.getTime()-new Date().getTime():0)-2e4;o();const b=new Date(Date.now()+O).toLocaleTimeString("en-US",{hour12:!1});gt(`Setting refresh timer for ${b}. (${O}ms)`),s(()=>{gt("Refreshing session due to timer"),d.refresh(p)},O)}var y}}));return ht(d,["logout","logoutAll"],c=>async(...u)=>{const p=await c(...u);return gt("Clearing all timers"),o(),p})},e=>t=>e(Object.assign(Object.assign({},t),{baseHeaders:Object.assign({"x-descope-sdk-name":"web-js","x-descope-sdk-version":"1.6.2"},t.baseHeaders)})),e=>t=>{const n=Ne(),i=Ne(),o=e(pt(t,{afterRequest:async(r,a)=>{if((a==null?void 0:a.status)===401)n.pub(null),i.pub(null);else{const d=await We(a);d&&i.pub(d);const{sessionJwt:c}=await Rt(a);c&&n.pub(c)}}})),s=ht(o,["logout","logoutAll"],r=>async(...a)=>{const d=await r(...a);return n.pub(null),i.pub(null),d});return Object.assign(s,{onSessionTokenChange:n.sub,onUserChange:i.sub})},e=>t=>{const n=e(pt(t,{afterRequest:async(o,s)=>{var r;const a=await We(s),d=(r=a==null?void 0:a.loginIds)===null||r===void 0?void 0:r[0],c=a==null?void 0:a.name;d&&((u=>{qt(me,u)})(d),(u=>{qt(be,u)})(c))}}));let i=ht(n,["flow.start"],vo);return i=ht(i,["logout","logoutAll"],mo),Object.assign(i,{getLastUserLoginId:In,getLastUserDisplayName:kn})},e=>t=>{var{persistTokens:n,sessionTokenViaCookie:i,storagePrefix:o}=t,s=Et(t,["persistTokens","sessionTokenViaCookie","storagePrefix"]);if(!n||!_t)return n&&console.warn("Storing auth tokens in local storage and cookies are a client side only capabilities and will not be done when running in the server"),e(s);const r=e(pt(s,{beforeRequest:(a=o,c=>Object.assign(c,{token:c.token||De(a)})),afterRequest:async(c,u)=>{(u==null?void 0:u.status)===401?Sn(o):bo(await Rt(u),i,o)}}));var a;const d=ht(r,["logout","logoutAll"],wo(o));return Object.assign(d,{getRefreshToken:()=>De(o),getSessionToken:()=>function(c=""){return ce.get(dt)||Vt(`${c}${dt}`)||""}(o)})})((...e)=>{const t=ho(...e);return Object.assign(Object.assign({},t),{flow:ko(t),webauthn:Io(t)})}),An=typeof localStorage<"u",$o=An&&localStorage.getItem("base.content.url")||"https://static.descope.com/pages",Un="descope-login-flow",Je="code",Fe="ra-challenge",He="ra-callback",Ve="ra-initiator",xn="data-exclude-field",Cn="dls_last_auth",Be="state_id",ze="saml_idp_state_id",Ge="saml_idp_username",Ze="sso_app_id",Wt="data-type",Oo="redirect",Qe="poll",ne="webauthnCreate",jo="webauthnGet",Ao="loadForm",Ye="submit",Xe="polling";var It,ie,oe;function T(e){return new URLSearchParams(window.location.search).get(e)}function q(e){if(window.history.replaceState&&T(e)){const t=new URL(window.location.href),n=new URLSearchParams(t.search);n.delete(e),t.search=n.toString(),window.history.replaceState({},"",t.toString())}}function Nt(e,t){return w(this,void 0,void 0,function*(){const n=yield fetch(e,{cache:"default"});if(!n.ok)throw Error(`Error fetching URL ${e} [${n.status}]`);return{body:yield n[t||"text"](),headers:Object.fromEntries(n.headers.entries())}})}(function(e){e.backward="backward",e.forward="forward"})(It||(It={}));function Dt(e,t){const n=new URL($o);return n.pathname=((...i)=>i.join("/").replace(/\/+/g,"/"))(n.pathname,e,"v2-alpha",t),n.toString()}function Uo(e,t){if(!Number.isNaN(e)&&!Number.isNaN(t))return e>t?It.forward:e<t?It.backward:void 0}const En=()=>{const[e="",t=""]=(T(Un)||"").split("_");return{executionId:e,stepId:t}};function Rn(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function Pn(){q(Un)}const Tn=e=>e.replace(/-./g,t=>t[1].toUpperCase()),xo=()=>{const{executionId:e,stepId:t}=En();(e||t)&&Pn();const n=T("t")||void 0;n&&q("t");const i=T(Je)||void 0;i&&q(Je);const o=T("err")||void 0;o&&q("err");const{redirectAuthCodeChallenge:s,redirectAuthCallbackUrl:r,redirectAuthInitiator:a}={redirectAuthCodeChallenge:T(Fe),redirectAuthCallbackUrl:T(He),redirectAuthInitiator:T(Ve)};(s||r||a)&&(q(Fe),q(He),q(Ve));const d=T(Be);d&&q(Be);const c=T(ze);c&&q(ze);const u=T(Ge);c&&q(Ge);const p=T(Ze);return p&&q(Ze),{executionId:e,stepId:t,token:n,code:i,exchangeError:o,redirectAuthCodeChallenge:s,redirectAuthCallbackUrl:r,redirectAuthInitiator:a,oidcIdpStateId:d,samlIdpStateId:c,samlIdpUsername:u,ssoAppId:p}},ye=e=>{let t,n;return(...i)=>{return t&&(s=i,(o=t).length===s.length&&o.every((r,a)=>r===s[a]))||(t=i,n=e(...i)),n;var o,s}},Co=(oe=(ie=navigator==null?void 0:navigator.userAgentData)===null||ie===void 0?void 0:ie.brands)===null||oe===void 0?void 0:oe.find(({brand:e,version:t})=>e==="Chromium"&&parseFloat(t)),tn=(e,t,n,i,o)=>e&&!t&&e&&!n&&!i&&e&&!o,Eo=e=>e==null?void 0:e.submit();var W,Z,st,Pt;function Ln(e,t){const n=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);if(n.length!==i.length)return!1;for(let o=0;o<n.length;o+=1){const s=n[o],r=e[s],a=t[s];if(r===null||a===null){if(r!==a)return!1}else if(typeof r=="object"&&typeof a=="object"){if(!Ln(r,a))return!1}else if(r!==a)return!1}return!0}class bt{constructor(t={},{updateOnlyOnChange:n=!0}={}){W.set(this,void 0),Z.set(this,{}),st.set(this,0),Pt.set(this,!1),this.update=i=>{const o=typeof i=="function"?i(l(this,W,"f")):i,s=Object.assign(Object.assign({},l(this,W,"f")),o);if(!l(this,Pt,"f")||!Ln(l(this,W,"f"),s)){const r=l(this,W,"f");P(this,W,s,"f"),Object.freeze(l(this,W,"f")),setTimeout(()=>{Object.values(l(this,Z,"f")).forEach(a=>a(s,r,((d,c)=>u=>d[u]!==c[u])(s,r)))},0)}},P(this,W,t,"f"),P(this,Pt,n,"f")}get current(){return Object.assign({},l(this,W,"f"))}subscribe(t){return P(this,st,l(this,st,"f")+1,"f"),l(this,Z,"f")[l(this,st,"f")]=t,l(this,st,"f").toString()}unsubscribe(t){const n=!!l(this,Z,"f")[t];return n&&delete l(this,Z,"f")[t],n}unsubscribeAll(){return P(this,Z,{},"f"),!0}}W=new WeakMap,Z=new WeakMap,st=new WeakMap,Pt=new WeakMap;const en=(e,t)=>{Object.entries(t||{}).forEach(([n,i])=>{Array.from(e.querySelectorAll(`.descope-input[name="${n}"]:not([${xn}])`)).forEach(o=>{o.value=i})})},Ro=(e,t,n,i)=>{var o;let s=t==null?void 0:t.errorText;try{s=(n==null?void 0:n({text:t==null?void 0:t.errorText,type:t==null?void 0:t.errorType}))||(t==null?void 0:t.errorText)}catch(r){i.error("Error transforming error message",r.message)}((r,a,d="")=>{r.querySelectorAll(`[${Wt}="${a}"]`).forEach(c=>{c.textContent=d,c.classList[d?"remove":"add"]("hide")})})(e,"error-message",s),en(e,t==null?void 0:t.inputs),en(e,t==null?void 0:t.form),((r,a)=>{r.querySelectorAll(`[${Wt}="totp-link"]`).forEach(d=>{d.href=a})})(e,(o=t==null?void 0:t.totp)===null||o===void 0?void 0:o.provisionUrl),((r,a)=>{r.querySelectorAll(".descope-text,.descope-link").forEach(d=>{d.textContent=((c,u)=>c.replace(/{{(.+?)}}/g,(p,f)=>{return y=u,f.split(".").reduce((O,b)=>(O==null?void 0:O[b])||"",y);var y}))(d.textContent,a)})})(e,t)},Po=ye(()=>w(void 0,void 0,void 0,function*(){var e,t,n,i;if(!window.PublicKeyCredential||!PublicKeyCredential.isConditionalMediationAvailable||!PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable)return console.warn("webauthn","Conditional UI is not supported"),!1;try{const o=Promise.all([(e=window.PublicKeyCredential)===null||e===void 0?void 0:e.isConditionalMediationAvailable(),(t=window.PublicKeyCredential)===null||t===void 0?void 0:t.isUserVerifyingPlatformAuthenticatorAvailable()]).then(r=>r.every(a=>!!a)),s=108;return yield Promise.race([o,(n=100,new Promise((r,a)=>{const d=setTimeout(()=>{a(new Error(`Promise timed out after ${n} ms`))},n);i==null||i(c=>{clearTimeout(d),r(c)},c=>{clearTimeout(d),a(c)})})).catch(()=>Co()>=s)])}catch(o){return console.warn("webauthn","Conditional login check failed",o),!1}})),nn={"lastAuth.loginId":{"not-empty":e=>!!e.loginId,empty:e=>!e.loginId},idpInitiated:{"is-true":e=>!!e.code,"is-false":e=>!e.code},externalToken:{"is-true":e=>!!e.token,"is-false":e=>!e.token}};function on(e){const t={};if(e)try{Object.assign(t,JSON.parse(localStorage.getItem(Cn)))}catch{}return t}const qn=document.createElement("template");var j,Tt,B,rt,H,ft,Kt,Mn,_n,Wn,ae,Nn,Dn,sn,Kn,wt,Jn,Fn,rn,an,le,Hn,Vn,Bn,R,at,Q,vt,J,de,ln,zn,dn,cn,un,hn,Gn,Zn,Lt;qn.innerHTML=`
	<style>
		:host {
			width: 100%;
			height: 100%;
		}
		
		#wc-root {
			height: 100%;
			transition: opacity 300ms ease-in-out;
		}

		#wc-root[data-theme] {
			background-color: transparent;
		}

		.fade-out {
			opacity: 0.1;
		}

	</style>
	<div id="wc-root"></div>
	`;class Y extends HTMLElement{static get observedAttributes(){return["project-id","flow-id","base-url","tenant","theme","locale","debug","storage-prefix","preview","telemetryKey","redirect-url","auto-focus","prefer-biometrics"]}constructor(t){super(),j.add(this),this.logger=console,Tt.set(this,!1),this.loggerWrapper={error:(n,i="")=>{this.logger.error(n,i,new Error),l(this,j,"m",Vn).call(this,n,i)},warn:(n,i="")=>{this.logger.warn(n,i)},info:(n,i="",o={})=>{this.logger.info(n,i,o)}},B.set(this,new bt({deferredRedirect:!1})),rt.set(this,new bt),this.nextRequestStatus=new bt({isLoading:!1}),H.set(this,void 0),ft.set(this,{popstate:l(this,j,"m",Nn).bind(this),visibilitychange:l(this,j,"m",Dn).bind(this)}),Kt.set(this,void 0),wt.set(this,ye(()=>w(this,void 0,void 0,function*(){const n=Dt(this.projectId,"config.json");try{const{body:i,headers:o}=yield Nt(n,"json");return{projectConfig:i,executionContext:{geo:o["x-geo"]}}}catch{this.loggerWrapper.error("Cannot get config file","make sure that your projectId & flowId are correct")}return{}}))),P(this,Kt,t,"f"),l(this,j,"m",Mn).call(this)}get projectId(){return this.getAttribute("project-id")}get flowId(){return this.getAttribute("flow-id")}get baseUrl(){return this.getAttribute("base-url")||void 0}get tenant(){return this.getAttribute("tenant")||void 0}get redirectUrl(){return this.getAttribute("redirect-url")||void 0}get debug(){return this.getAttribute("debug")==="true"}get locale(){return this.getAttribute("locale")||void 0}get theme(){var t,n;const i=this.getAttribute("theme");return i==="os"?window.matchMedia&&((n=(t=window.matchMedia)===null||t===void 0?void 0:t.call(window,"(prefers-color-scheme: dark)"))===null||n===void 0?void 0:n.matches)?"dark":"light":i||"light"}get telemetryKey(){return this.getAttribute("telemetryKey")||void 0}get autoFocus(){var t;const n=(t=this.getAttribute("auto-focus"))!==null&&t!==void 0?t:"true";return n==="skipFirstScreen"?n:n==="true"}get preferBiometrics(){var t;return((t=this.getAttribute("prefer-biometrics"))!==null&&t!==void 0?t:"true")==="true"}get storagePrefix(){return this.getAttribute("storage-prefix")||""}get preview(){return!!this.getAttribute("preview")}getExecutionContext(){return w(this,void 0,void 0,function*(){const{executionContext:t}=yield l(this,wt,"f").call(this);return t})}getFlowConfig(){var t,n;return w(this,void 0,void 0,function*(){const{projectConfig:i}=yield l(this,wt,"f").call(this),o=((t=i==null?void 0:i.flows)===null||t===void 0?void 0:t[this.flowId])||{};return(n=o.version)!==null&&n!==void 0||(o.version=0),o})}getTargetLocales(){return w(this,void 0,void 0,function*(){const t=yield this.getFlowConfig();return((t==null?void 0:t.targetLocales)||[]).map(n=>n.toLowerCase())})}connectedCallback(){return w(this,void 0,void 0,function*(){if(this.shadowRoot.isConnected){if(l(this,j,"m",_n).call(this))return void l(this,j,"m",Wn).call(this);l(this,j,"m",ae).call(this),l(this,j,"m",Fn).call(this),l(this,j,"m",Jn).call(this),l(this,j,"m",Bn).call(this);const{executionId:t,stepId:n,token:i,code:o,exchangeError:s,redirectAuthCallbackUrl:r,redirectAuthCodeChallenge:a,redirectAuthInitiator:d,oidcIdpStateId:c,samlIdpStateId:u,samlIdpUsername:p,ssoAppId:f}=xo();window.addEventListener("popstate",l(this,ft,"f").popstate),window.addEventListener("visibilitychange",l(this,ft,"f").visibilitychange),l(this,B,"f").subscribe(l(this,j,"m",Kn).bind(this)),l(this,rt,"f").subscribe(l(this,j,"m",Hn).bind(this)),l(this,B,"f").update({projectId:this.projectId,flowId:this.flowId,baseUrl:this.baseUrl,tenant:this.tenant,redirectUrl:this.redirectUrl,locale:this.locale,stepId:n,executionId:t,token:i,code:o,exchangeError:s,telemetryKey:this.telemetryKey,redirectAuthCallbackUrl:r,redirectAuthCodeChallenge:a,redirectAuthInitiator:d,oidcIdpStateId:c,samlIdpStateId:u,samlIdpUsername:p,ssoAppId:f}),l(this,rt,"f").update({isDebug:this.debug}),P(this,Tt,!0,"f")}})}disconnectedCallback(){l(this,B,"f").unsubscribeAll(),l(this,rt,"f").unsubscribeAll(),l(this,j,"m",le).call(this),window.removeEventListener("popstate",l(this,ft,"f").popstate)}attributeChangedCallback(t,n,i){if(this.shadowRoot.isConnected&&l(this,Tt,"f")&&n!==i&&Y.observedAttributes.includes(t)){l(this,j,"m",ae).call(this);const o=n===null;l(this,B,"f").update(({stepId:s,executionId:r})=>{let a=s,d=r;return o||(d=null,a=null,Pn()),{[Tn(t)]:i,stepId:a,executionId:d}}),l(this,rt,"f").update({isDebug:this.debug})}}}Tt=new WeakMap,B=new WeakMap,rt=new WeakMap,H=new WeakMap,ft=new WeakMap,Kt=new WeakMap,wt=new WeakMap,j=new WeakSet,Mn=function(){this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(qn.content.cloneNode(!0)),this.rootElement=this.shadowRoot.querySelector("#wc-root")},_n=function(){return!this.shadowRoot.host.closest("form")&&Rn()},Wn=function(){const e=this.shadowRoot.host,t=document.createElement("form");e.parentElement.appendChild(t),t.appendChild(e)},ae=function(){const e=["base-url","tenant","theme","locale","debug","telemetryKey","redirect-url","auto-focus","preview","storage-prefix","prefer-biometrics"];if(Y.observedAttributes.forEach(t=>{if(!e.includes(t)&&!this[Tn(t)])throw Error(`${t} cannot be empty`)}),this.theme&&this.theme!=="light"&&this.theme!=="dark")throw Error('Supported theme values are "light", "dark", or leave empty for using the OS theme')},Nn=function(){const{stepId:e,executionId:t}=En();l(this,B,"f").update({stepId:e,executionId:t})},Dn=function(){document.hidden||setTimeout(()=>{l(this,B,"f").update({deferredRedirect:!1})},300)},sn=function(e,t,n){const i=n||void 0,o=!!i;this.sdk=So(Object.assign(Object.assign({persistTokens:!0,preview:this.preview,storagePrefix:this.storagePrefix},Y.sdkConfigOverrides),{projectId:e,baseUrl:t,fpKey:i,fpLoad:o})),["start","next"].forEach(s=>{const r=this.sdk.flow[s];this.sdk.flow[s]=(...a)=>w(this,void 0,void 0,function*(){this.nextRequestStatus.update({isLoading:!0});try{return yield r(...a)}finally{this.nextRequestStatus.update({isLoading:!1})}})})},Kn=function(e,t,n){return w(this,void 0,void 0,function*(){const{projectId:i,baseUrl:o,telemetryKey:s}=e;if(n("projectId")||n("baseUrl")||n("telemetryKey")){if(!i)return;l(this,j,"m",sn).call(this,i,o,s)}l(this,Kt,"f").call(this,e)})},Jn=function(){var e,t,n,i;return w(this,void 0,void 0,function*(){const{projectConfig:o}=yield l(this,wt,"f").call(this);(i=(n=(t=(e=o==null?void 0:o.cssTemplate)===null||e===void 0?void 0:e[this.theme])===null||t===void 0?void 0:t.typography)===null||n===void 0?void 0:n.fontFamilies)===null||i===void 0||i.forEach(s=>(r=>{if(!r)return;const a=document.createElement("link");a.href=r,a.rel="stylesheet",document.head.appendChild(a)})(s.url))})},Fn=function(){l(this,j,"m",rn).call(this),l(this,j,"m",an).call(this)},rn=function(){return w(this,void 0,void 0,function*(){const e=document.createElement("style"),t=Dt(this.projectId,"theme.css");try{const{body:n}=yield Nt(t,"text");e.innerText=n}catch{this.loggerWrapper.error("Cannot fetch theme file","make sure that your projectId & flowId are correct")}this.shadowRoot.appendChild(e)})},an=function(){this.rootElement.setAttribute("data-theme",this.theme)},le=function(){var e;(e=l(this,H,"f"))===null||e===void 0||e.remove(),P(this,H,null,"f")},Hn=function({isDebug:e}){return w(this,void 0,void 0,function*(){e?(yield si(()=>import("./debugger-wc-23d536f0.684c1bc2.js"),["assets/debugger-wc-23d536f0.684c1bc2.js","assets/index.0a346673.js","assets/index.da271e72.css"]),P(this,H,document.createElement("descope-debugger"),"f"),Object.assign(l(this,H,"f").style,{position:"fixed",top:"0",right:"0",height:"100vh",width:"100vw",pointerEvents:"none",zIndex:99999}),document.body.appendChild(l(this,H,"f"))):l(this,j,"m",le).call(this)})},Vn=function(e,t){var n;e&&this.debug&&((n=l(this,H,"f"))===null||n===void 0||n.updateData({title:e,description:t}))},Bn=function(){this.rootElement.onkeydown=e=>{if(e.key!=="Enter")return;e.preventDefault();const t=this.rootElement.querySelectorAll("button");if(t.length===1)return void t[0].click();const n=Array.from(t).filter(i=>i.getAttribute("data-type")==="button");n.length===1&&n[0].click()}},Y.sdkConfigOverrides={baseHeaders:{"x-descope-sdk-name":"web-component","x-descope-sdk-version":"2.11.3"}};class Qn extends Y{static set sdkConfigOverrides(t){Y.sdkConfigOverrides=t}constructor(){const t=new bt;super(t.update.bind(t)),R.add(this),this.stepState=new bt({},{updateOnlyOnChange:!1}),at.set(this,void 0),Q.set(this,null),vt.set(this,()=>{clearInterval(l(this,at,"f")),P(this,at,null,"f")}),J.set(this,n=>{var i,o,s,r,a,d,c,u,p;if(!(n!=null&&n.ok)){l(this,vt,"f").call(this),l(this,R,"m",Lt).call(this,"error",n==null?void 0:n.error);const F=(i=n==null?void 0:n.response)===null||i===void 0?void 0:i.url,St=`${(o=n==null?void 0:n.response)===null||o===void 0?void 0:o.status} - ${(s=n==null?void 0:n.response)===null||s===void 0?void 0:s.statusText}`;return void this.loggerWrapper.error(((r=n==null?void 0:n.error)===null||r===void 0?void 0:r.errorDescription)||F,((a=n==null?void 0:n.error)===null||a===void 0?void 0:a.errorMessage)||St)}const f=(u=(c=(d=n.data)===null||d===void 0?void 0:d.screen)===null||c===void 0?void 0:c.state)===null||u===void 0?void 0:u.errorText;!((p=n.data)===null||p===void 0)&&p.error?this.loggerWrapper.error(`[${n.data.error.code}]: ${n.data.error.description}`,`${f?`${f} - `:""}${n.data.error.message}`):f&&this.loggerWrapper.error(f);const{status:y,authInfo:O,lastAuth:b}=n.data;if(y==="completed")return function(F){(F==null?void 0:F.authMethod)&&An&&localStorage.setItem(Cn,JSON.stringify(F))}(b),l(this,vt,"f").call(this),void l(this,R,"m",Lt).call(this,"success",O);const{executionId:k,stepId:I,stepName:C,action:A,screen:S,redirect:x,webauthn:N,error:X,samlIdpResponse:D}=n.data;A!==Qe?(this.loggerWrapper.info(`Step "${C||`#${I}`}" is ${y}`,"",{screen:S,status:y,stepId:I,stepName:C,action:A,error:X}),this.flowState.update({stepId:I,executionId:k,action:A,redirectTo:x==null?void 0:x.url,screenId:S==null?void 0:S.id,screenState:S==null?void 0:S.state,webauthnTransactionId:N==null?void 0:N.transactionId,webauthnOptions:N==null?void 0:N.options,samlIdpResponseUrl:D==null?void 0:D.url,samlIdpResponseSamlResponse:D==null?void 0:D.samlResponse,samlIdpResponseRelayState:D==null?void 0:D.relayState})):this.flowState.update({action:A})}),de.set(this,ye(()=>w(this,void 0,void 0,function*(){var n;try{const i=yield this.sdk.webauthn.signIn.start("",window.location.origin);return i.ok||this.loggerWrapper.error("Webauthn start failed",(n=i==null?void 0:i.error)===null||n===void 0?void 0:n.errorMessage),i.data}catch(i){this.loggerWrapper.error("Webauthn start failed",i.message)}}))),this.flowState=t}connectedCallback(){const t=Object.create(null,{connectedCallback:{get:()=>super.connectedCallback}});var n,i;return w(this,void 0,void 0,function*(){this.shadowRoot.isConnected&&((n=this.flowState)===null||n===void 0||n.subscribe(this.onFlowChange.bind(this)),(i=this.stepState)===null||i===void 0||i.subscribe(this.onStepChange.bind(this))),yield t.connectedCallback.call(this)})}disconnectedCallback(){super.disconnectedCallback(),this.flowState.unsubscribeAll(),this.stepState.unsubscribeAll()}getHtmlFilenameWithLocale(t,n){return w(this,void 0,void 0,function*(){let i,o=navigator.language;o&&o!=="zh-TW"&&(o=o.split("-")[0]);const s=(t||o||"").toLowerCase();return(yield this.getTargetLocales()).includes(s)&&(i=`${n}-${s}.html`),i})}getPageContent(t,n){return w(this,void 0,void 0,function*(){if(n)try{const{body:i}=yield Nt(n,"text");return i}catch(i){this.loggerWrapper.error(`Failed to fetch html page from ${n}. Fallback to url ${t}`,i)}try{const{body:i}=yield Nt(t,"text");return i}catch(i){this.loggerWrapper.error(`Failed to fetch html page from ${t}`,i)}return null})}onFlowChange(t,n,i){var o,s,r,a,d,c;return w(this,void 0,void 0,function*(){const{projectId:u,flowId:p,tenant:f,stepId:y,executionId:O,action:b,screenId:k,screenState:I,redirectTo:C,redirectUrl:A,token:S,code:x,exchangeError:N,webauthnTransactionId:X,webauthnOptions:D,redirectAuthCodeChallenge:F,redirectAuthCallbackUrl:St,redirectAuthInitiator:Yn,oidcIdpStateId:$t,locale:Xn,samlIdpStateId:Ot,samlIdpUsername:ut,samlIdpResponseUrl:Ie,samlIdpResponseSamlResponse:ke,samlIdpResponseRelayState:ti,ssoAppId:jt}=t;let z,At;l(this,at,"f")&&l(this,vt,"f").call(this);const tt=this.sdk.getLastUserLoginId(),_=yield this.getFlowConfig(),Se=St&&F?{callbackUrl:St,codeChallenge:F}:void 0;if(!O&&(_.conditions?{startScreenId:z,conditionInteractionId:At}=((m,E)=>{const U=E==null?void 0:E.find(({key:K,operator:$})=>{var zt;if(K==="ELSE")return!0;const je=(zt=nn[K])===null||zt===void 0?void 0:zt[$];return!!(je!=null&&je(m))});return U?{startScreenId:U.met.screenId,conditionInteractionId:U.met.interactionId}:{}})({loginId:tt,code:x,token:S},_.conditions):_.condition?{startScreenId:z,conditionInteractionId:At}=((m,E)=>{var U;const K=(U=nn[m==null?void 0:m.key])===null||U===void 0?void 0:U[m.operator];if(!K)return{};const $=K(E)?m.met:m.unmet;return{startScreenId:$==null?void 0:$.screenId,conditionInteractionId:$==null?void 0:$.interactionId}})(_.condition,{loginId:tt,code:x,token:S}):z=_.startScreenId,!tn(z,$t,Ot,ut,jt))){const m={};let E=!1;x&&(E=!0,m.exchangeCode=x,m.idpInitiated=!0),S&&(E=!0,m.token=S);const U=yield this.sdk.flow.start(p,Object.assign(Object.assign({tenant:f,redirectAuth:Se,oidcIdpStateId:$t,samlIdpStateId:Ot,samlIdpUsername:ut,ssoAppId:jt},A&&{redirectUrl:A}),{lastAuth:on(tt)}),At,"",E?m:void 0,_.version);return l(this,J,"f").call(this,U),void(((o=U==null?void 0:U.data)===null||o===void 0?void 0:o.status)!=="completed"&&this.flowState.update({code:void 0,token:void 0}))}if(O&&(i("token")&&S||i("code")&&x||i("exchangeError")&&N)){const m=yield this.sdk.flow.next(O,y,Ye,{token:S,exchangeCode:x,exchangeError:N},_.version);return l(this,J,"f").call(this,m),void this.flowState.update({token:void 0,code:void 0,exchangeError:void 0})}if(b===Ao&&["samlIdpResponseUrl","samlIdpResponseSamlResponse","samlIdpResponseRelayState"].some(m=>i(m))){if(!Ie||!ke)return void this.loggerWrapper.error("Did not get saml idp params data to load");((m,E,U,K)=>{const $=document.createElement("form");$.method="POST",$.action=m,$.innerHTML=`
  <input type="hidden" role="saml-response" name="SAMLResponse" value="${E}" />
  <input type="hidden" role="saml-relay-state" name="RelayState" value="${U}" />
  <input style="display: none;" id="SAMLSubmitButton" type="submit" value="Continue" />
  `,document.body.appendChild($),K($)})(Ie,ke,ti||"",Eo)}if(b===Oo&&(i("redirectTo")||i("deferredRedirect")))return C?Yn==="android"&&document.hidden?void this.flowState.update({deferredRedirect:!0}):void window.location.assign(C):void this.loggerWrapper.error("Did not get redirect url");if(b===ne||b===jo){if(!X||!D)return void this.loggerWrapper.error("Did not get webauthn transaction id or options");let m,E,U=D;if(this.preferBiometrics&&b===ne&&Rn()&&(yield(r=(s=window.PublicKeyCredential)===null||s===void 0?void 0:s.isUserVerifyingPlatformAuthenticatorAvailable)===null||r===void 0?void 0:r.call(s)))try{const $=JSON.parse(U);$.publicKey&&((d=$.publicKey).authenticatorSelection||(d.authenticatorSelection={}),(c=$.publicKey.authenticatorSelection).authenticatorAttachment||(c.authenticatorAttachment="platform"),U=JSON.stringify($))}catch{this.loggerWrapper.info("Failed to modify webauthn create options")}(a=l(this,Q,"f"))===null||a===void 0||a.abort(),P(this,Q,null,"f");try{m=b===ne?yield this.sdk.webauthn.helpers.create(U):yield this.sdk.webauthn.helpers.get(U)}catch($){if($.name!=="NotAllowedError")return void this.loggerWrapper.error($.message);E=!0}const K=yield this.sdk.flow.next(O,y,Ye,{transactionId:X,response:m,cancelWebauthn:E},_.version);l(this,J,"f").call(this,K)}if(b===Qe&&P(this,at,setInterval(()=>w(this,void 0,void 0,function*(){const m=yield this.sdk.flow.next(O,y,Xe,{},_.version);l(this,J,"f").call(this,m)}),2e3),"f"),!k&&!z)return void this.loggerWrapper.warn("No screen was found to show");const $e=z||k,Oe=yield this.getHtmlFilenameWithLocale(Xn,$e),Bt={direction:Uo(+y,+n.stepId),screenState:Object.assign(Object.assign({},I),{lastAuth:{loginId:tt,name:this.sdk.getLastUserDisplayName()||tt}}),htmlUrl:Dt(u,`${$e}.html`),htmlLocaleUrl:Oe&&Dt(u,Oe),samlIdpUsername:ut},ei=on(tt);tn(z,$t,Ot,ut,jt)?Bt.next=(m,E)=>this.sdk.flow.start(p,Object.assign({tenant:f,redirectAuth:Se,oidcIdpStateId:$t,samlIdpStateId:Ot,samlIdpUsername:ut,ssoAppId:jt,lastAuth:ei,preview:this.preview},A&&{redirectUrl:A}),At,m,Object.assign(Object.assign(Object.assign({},E),x&&{exchangeCode:x,idpInitiated:!0}),S&&{token:S}),_.version):(i("projectId")||i("baseUrl")||i("executionId")||i("stepId"))&&(Bt.next=(...m)=>this.sdk.flow.next(O,y,...m)),this.stepState.update(Bt)})}onStepChange(t,n){var i,o,s;return w(this,void 0,void 0,function*(){const{htmlUrl:r,htmlLocaleUrl:a,direction:d,next:c,screenState:u}=t,p=document.createElement("template");p.innerHTML=yield this.getPageContent(r,a);const f=p.content.cloneNode(!0),y=((b,k)=>{var I;const C=Array.from(b.querySelectorAll("script[data-id]")).map(A=>{var S;const x=A.getAttribute("data-id"),N=(S=b.getElementById(x))===null||S===void 0?void 0:S.innerHTML,X=Function(N).bind(A.previousSibling,k);return A.remove(),X});return(I=b.querySelector("scripts"))===null||I===void 0||I.remove(),C})(f,yield this.getExecutionContext());this.sdk.webauthn.helpers.isSupported()?yield l(this,R,"m",zn).call(this,f,c):f.querySelectorAll(`button[${Wt}="biometrics"]`).forEach(b=>b.setAttribute("disabled","true")),!t.samlIdpUsername||((i=u.form)===null||i===void 0?void 0:i.loginId)||((o=u.form)===null||o===void 0?void 0:o.email)||(u.form||(u.form={}),u.form.loginId=t.samlIdpUsername,u.form.email=t.samlIdpUsername),Ro(f,u,this.errorTransformer,this.loggerWrapper),((b,k)=>{var I;k&&((I=b==null?void 0:b.style)===null||I===void 0||I.setProperty("--totp-image",`url(data:image/jpg;base64,${k})`))})(f.querySelector("div"),(s=u==null?void 0:u.totp)===null||s===void 0?void 0:s.image);const O=()=>w(this,void 0,void 0,function*(){try{y.forEach(k=>{k()})}catch(k){this.loggerWrapper.error(k.message)}this.rootElement.replaceChildren(f);const b=!n.htmlUrl;if(((k,I,C)=>{if(I===!0||I==="skipFirstScreen"&&!C){const A=k.querySelector('input:not([aria-hidden="true"])');A==null||A.focus()}})(this.rootElement,this.autoFocus,b),l(this,R,"m",Gn).call(this,c),l(this,R,"m",Lt).call(this,"page-updated",{}),this.rootElement.querySelector(`[${Wt}="polling"]`)){const k=yield c(Xe,{});l(this,J,"f").call(this,k)}});d?l(this,R,"m",Zn).call(this,O,d):O()})}}at=new WeakMap,Q=new WeakMap,vt=new WeakMap,J=new WeakMap,de=new WeakMap,R=new WeakSet,ln=function(e){const t=e.name;if(!["email"].includes(t)){const n=`user-${t}`;e.name=n,e.addEventListener("input",()=>{e.name=e.value?t:n})}},zn=function(e,t){var n;return w(this,void 0,void 0,function*(){(n=l(this,Q,"f"))===null||n===void 0||n.abort();const i=e.querySelector('input[autocomplete="webauthn"]');if(i&&(yield Po())){const{options:o,transactionId:s}=(yield l(this,de,"f").call(this))||{};o&&s&&(l(this,R,"m",ln).call(this,i),P(this,Q,new AbortController,"f"),this.sdk.webauthn.helpers.conditional(o,l(this,Q,"f")).then(r=>w(this,void 0,void 0,function*(){const a=yield t(i.id,{transactionId:s,response:r});l(this,J,"f").call(this,a)})).catch(r=>{r.name!=="AbortError"&&this.loggerWrapper.error("Conditional login failed",r.message)}))}})},dn=function(){return Array.from(this.shadowRoot.querySelectorAll(".descope-input")).every(e=>(e.reportValidity(),e.checkValidity()))},cn=function(){return w(this,void 0,void 0,function*(){const e=Array.from(this.shadowRoot.querySelectorAll(`.descope-input[name]:not([${xn}])`));return(yield Promise.all(e.map(n=>w(this,void 0,void 0,function*(){const i=yield(o=>new Promise(s=>{var r;switch(o.type){case"checkbox":s(o.checked);break;case"file":{const a=new FileReader;!((r=o.files)===null||r===void 0)&&r.length?(a.onload=d=>{const c=d.target.result;s(c)},a.readAsDataURL(o.files[0])):s(null);break}default:s(o.value)}}))(n);return{name:n.name,value:i}})))).reduce((n,i)=>Object.assign(Object.assign({},n),{[i.name]:i.value}),{})})},un=function(e){const t=this.nextRequestStatus.subscribe(({isLoading:n})=>{var i,o;n?(i=e==null?void 0:e.classList)===null||i===void 0||i.add("loading"):(this.nextRequestStatus.unsubscribe(t),(o=e==null?void 0:e.classList)===null||o===void 0||o.remove("loading"))})},hn=function(e,t){return w(this,void 0,void 0,function*(){if(e.formNoValidate||l(this,R,"m",dn).call(this)){const i=e==null?void 0:e.getAttribute("id");l(this,R,"m",un).call(this,e);const o=yield l(this,R,"m",cn).call(this),s=(n=e,Array.from((n==null?void 0:n.attributes)||[]).reduce((d,c)=>{var u;const p=(u=new RegExp("^data-descope-(\\S+)$").exec(c.name))===null||u===void 0?void 0:u[1];return p?Object.assign(d,{[p]:c.value}):d},{})),r=Object.assign(Object.assign(Object.assign({},s),o),{origin:window.location.origin}),a=yield t(i,r);l(this,J,"f").call(this,a)}var n})},Gn=function(e){this.rootElement.querySelectorAll("button:not([data-exclude-next])").forEach(t=>{t.onclick=()=>{l(this,R,"m",hn).call(this,t,e)}})},Zn=function(e,t){this.rootElement.addEventListener("transitionend",()=>{this.rootElement.classList.remove("fade-out"),e()},{once:!0});const n=t===It.forward?"slide-forward":"slide-backward";Array.from(this.rootElement.getElementsByClassName("input-container")).forEach((i,o)=>{i.style["transition-delay"]=40*o+"ms",i.classList.add(n)}),this.rootElement.classList.add("fade-out")},Lt=function(e,t){this.dispatchEvent(new CustomEvent(e,{detail:t}))},customElements.define("descope-wc",Qn);const Lo=Object.freeze(Object.defineProperty({__proto__:null,default:Qn},Symbol.toStringTag,{value:"Module"}));export{bt as J,Lo as i};
